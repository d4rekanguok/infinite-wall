!function(t,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o(require("react"),require("hammerjs")):"function"==typeof define&&define.amd?define(["react","hammerjs"],o):t.infiniteWall=o(t.react,t.hammerjs)}(this,function(t,o){t=t&&t.hasOwnProperty("default")?t.default:t,o=o&&o.hasOwnProperty("default")?o.default:o;var n=function(t,o){return void 0===t&&(t=0),{row:~~(t/o),col:t%o}},e=function(e){function s(o){e.call(this,o),this.state={isReady:!1},this.wallRef=t.createRef(),this.slots=[],this.loopCount={x:0,y:0},this.contentRootPos={x:0,y:0},this.slotRootPos={x:0,y:0},this.wallBounding={},this.config={},this.slotConfig={},this.contentConfig={},this.updateRootPos=this.updateRootPos.bind(this),this.goToPos=this.goToPos.bind(this),this.snap=this.snap.bind(this)}return e&&(s.__proto__=e),(s.prototype=Object.create(e&&e.prototype)).constructor=s,s.prototype.componentDidMount=function(){var t=this,n=this.wallRef.current;this.wallBounding=n.getBoundingClientRect();var e=this.wallBounding;this.config=Object.assign({},this.props.config,{width:this.wallBounding.width/4,height:200});var i=this.config,s=i.contentSize,r={x:-.5*-this.config.width,y:-.5*-this.config.height};this.contentRootPos=Object.assign({},r),this.slotRootPos=Object.assign({},r),this.slotConfig=function(t){var o=t.wallBounding,n=t.config,e=o.height,i=n.width,s=n.height,r=n.gap,a=Math.round(o.width/(i+r))+1,h=Math.round(e/(s+r))+1;return{slotCols:a,slotRows:h,slotAmount:a*h,slotTotalWidth:(i+r)*a,slotTotalHeight:(s+r)*h}}({wallBounding:e,config:i}),this.contentConfig=function(t){var o=t.config,n=o.gap,e=o.cols,i=o.width,s=o.height,r=Math.ceil(t.contentSize/e);return{contentCols:e,contentRows:r,contentTotalWidth:(i+n)*e,contentTotalHeight:(s+n)*r}}({contentSize:s,config:i});var a=0,h=0,l=null;n.onwheel=function(o){o.stopPropagation();var n=t.contentRootPos;t.updateRootPos({x:n.x-o.deltaX,y:n.y-o.deltaY}),t.updateSlots(),clearTimeout(l),l=setTimeout(function(){t.snap({duration:200})},100)},window.onkeydown=function(o){var n=o.keyCode;if(!(n>40||n<37)){var e=t.contentRootPos,i=t.config,s=i.gap,r=i.width,a=i.height,h=e.x,l=e.y;switch(n){case 40:l+=s+a;break;case 39:h+=s+r;break;case 38:l-=s+a;break;case 37:h-=s+r}t.goToPos({x:h,y:l},{duration:150})}};var c=new o.Manager(n);c.add(new o.Pan({direction:o.DIRECTION_ALL,threshold:0})),c.on("panstart",function(o){console.log("panstart");var n=o.center,e=t.contentRootPos;h=n.y-e.y,a=n.x-e.x}),c.on("panmove",function(o){var n=o.center;t.updateRootPos({x:n.x-a,y:n.y-h}),t.updateSlots()}),c.on("panend",function(o){console.log("panend"),t.snap()}),this.createSlots(),this.setState({isReady:!0})},s.prototype.updateRootPos=function(t){void 0===t&&(t={x:0,y:0});var o=t.x,n=t.y,e=this.slotConfig,i=e.slotTotalWidth,s=e.slotTotalHeight,r=this.contentConfig,a=r.contentTotalWidth,h=this.contentRootPos,l=this.slotRootPos,c=this.loopCount;h.y=n%r.contentTotalHeight,h.x=o%a,c.y=-Math.ceil(n/s),c.y<0&&c.y++,c.x=-Math.ceil(o/i),c.x<0&&c.x++,l.y=n%s,l.x=o%i},s.prototype.snap=function(t){void 0===t&&(t={duration:150});var o=this.config,n=o.snap,e=o.gap;if(n){var i=this.contentRootPos,s=i.x,r=o.height+e,a=o.width+e,h=r/2,l=a/2,c=r*Math.round((i.y-h)/r)+h,d=a*Math.round((s-l)/a)+l;this.goToPos({x:d,y:c},t)}},s.prototype.goToPos=function(t,o){void 0===t&&(t={x:0,y:0}),void 0===o&&(o={duration:0});var n=o.duration;if(0===n)return this.updateRootPos(t),void this.updateSlots();var e=Object.assign({},this.contentRootPos),i=null,s={x:0,y:0},r=this.updateRootPos.bind(this),a=this.updateSlots.bind(this);window.requestAnimationFrame(function o(h){i||(i=h);var l=h-i;s.x=e.x+(t.x-e.x)/n*l,s.y=e.y+(t.y-e.y)/n*l,r(s),a(),l<n&&window.requestAnimationFrame(o)})},s.prototype.createSlots=function(){if(this.slots.length>0)console.error("slots had alisReady been created.");else{var o=this.slotConfig,e=o.slotAmount,i=o.slotCols,s=this.config,r=s.width,a=s.height,h=document.head,l=document.createElement("style");l.type="text/css",l.appendChild(document.createTextNode("\n      .infinite-wall-slot {\n        position: absolute;\n        display: block;\n        box-sizing: border-box;\n        top: 0; left: 0;\n        width: "+r+"px; height: "+a+"px;\n      }\n      ")),h.appendChild(l);for(var c=0;c<e;c++){var d=n(c,i),p=t.createRef();this.slots.push({gridPos:d,ref:p})}}},s.prototype.updateSlots=function(){var t=this;this.state.isReady&&this.slots.forEach(function(o){o.ref.current.updateSlot(t.slotRootPos,t.loopCount)})},s.prototype.render=function(){var t=this,o=this.slotConfig,n=this.contentConfig,e=this.config,s=this.slotRootPos;return h("ul",{style:{position:"absolute",margin:0,padding:0,top:0,left:0,width:"100%",height:"100%",overflow:"hidden"},ref:this.wallRef},this.state.isReady&&this.slots.map(function(r,a){return h(i,{ref:r.ref,key:a,id:a,gridPos:r.gridPos,slotConfig:o,config:e,contentConfig:n,initPos:s,render:t.props.render})}))},s}(t.PureComponent),i=function(o){function n(n){o.call(this,n),this.ref=t.createRef(),this.id=this.props.id,this.state={contentId:0},this.updateSlot=this.updateSlot.bind(this),this.getSlotPosFromRootPos=this.getSlotPosFromRootPos.bind(this)}return o&&(n.__proto__=o),(n.prototype=Object.create(o&&o.prototype)).constructor=n,n.prototype.componentDidMount=function(){this.updateSlot(this.props.initPos)},n.prototype.updateSlot=function(t,o){var n=this.state.contentId,e=this.getSlotPosFromRootPos(t),i=e.slotX,s=e.slotY,r=this.updateContent({col:e.col,row:e.row},o).contentId;r!==n&&this.setState({contentId:r}),this.ref.current.style="transform: translate("+i+"px, "+s+"px);"},n.prototype.getSlotPosFromRootPos=function(t){void 0===t&&(t={x:0,y:0});var o=this.props,n=o.slotConfig,e=o.gridPos,i=o.config,s=n.slotCols,r=n.slotRows,a=t.x,h=t.y,l=i.width,c=i.height,d=i.gap,p=e.col,u=e.row,f=Math.ceil(a/(l+d))+p;f>=s&&(p-=s),f<0&&(p+=s);var g=Math.ceil(h/(c+d))+u;return g>=r&&(u-=r),g<0&&(u+=r),{slotY:h+u*(c+d),slotX:a+p*(l+d),col:p,row:u}},n.prototype.updateContent=function(t,o){void 0===t&&(t={col:0,row:0}),void 0===o&&(o={x:0,y:0});var n,e,i=this.props,s=i.slotConfig,r=i.contentConfig,a=i.config.contentSize,h=r.contentCols,l=(e=(t.row+o.y*s.slotRows)%r.contentRows)*h+(n=(t.col+o.x*s.slotCols)%h);return l<0&&(l+=a),l>a&&(l=null),{contentCol:n,contentRow:e,contentId:l}},n.prototype.render=function(){var t=this.props.render;return h("li",{className:"infinite-wall-slot",ref:this.ref},t({data:{id:this.id,contentId:this.state.contentId}}))},n}(t.PureComponent);return e});
//# sourceMappingURL=index.umd.js.map
